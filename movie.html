<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infinite Scroll with Search</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .free-text {
      color: red;
    }
    .spinner {
      display: none;
      margin: 20px auto;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="my-4">PDF Files</h1>
  <input type="text" id="searchInput" class="form-control mb-4" placeholder="Search...">
  
  <div id="cardsContainer" class="row"></div>
  <div class="spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
  <p id="noMoreResults" class="text-center"></p>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script>
  const itemsPerPage = 12;
  let currentPage = 1;
  let allData = [];
  let filteredData = [];

  $(document).ready(function() {
    fetchData();

    $('#searchInput').on('input', function() {
      const query = $(this).val().toLowerCase();
      filterData(query);
    });

    $(window).scroll(function() {
      if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
        if ((currentPage - 1) * itemsPerPage < filteredData.length) {
          loadMoreData();
        } else {
          $('#noMoreResults').text('NO MORE RESULTS FOUND');
        }
      }
    });
  });

  function fetchData() {
    $.getJSON('SciencePrimarySevenClassPastPapers.json', function(data) {
      allData = data;
      filteredData = data;
      renderData();
    });
  }

  function renderData() {
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = currentPage * itemsPerPage;
    const currentData = filteredData.slice(startIndex, endIndex);

    if (currentData.length === 0 && currentPage === 1) {
      $('#cardsContainer').html('<p class="col-12 text-center">NO RESULTS FOUND</p>');
    } else {
      currentData.forEach((item, index) => {
        $('#cardsContainer').append(`
          <div class="col-md-4 mb-3">
            <div class="card">
              <div class="card-body">
                <h3>${item.title}</h3>
                <p class="description">${item.description}</p>
                <p>Price: <span class="price"><del>${item.price}</del></span> <span class="free-text">FREE</span></p>
                <div class="button">
                  <a href="${item.pdfUrl}" class="btn btn-primary mt-2 mr-2 text-white">View File <i class="fas fa-book-reader fa-lg"></i></a>
                  <a href="${item.pdfUrl}" class="btn btn-info mt-2 text-white" download>Download File <i class="fas fa-download fa-lg"></i></a>
                </div>
              </div>
            </div>
          </div>
        `);
      });
      if (currentData.length < itemsPerPage) {
        $('#noMoreResults').text('NO MORE RESULTS FOUND');
      }
    }
  }

  function loadMoreData() {
    $('.spinner').show();
    setTimeout(() => {
      currentPage++;
      renderData();
      $('.spinner').hide();
    }, 1000);
  }

  function filterData(query) {
    filteredData = allData.filter(item => 
      item.title.toLowerCase().includes(query) || 
      item.description.toLowerCase().includes(query)
    );
    currentPage = 1;
    $('#cardsContainer').empty();
    $('#noMoreResults').text('');
    renderData();
  }
</script>

</body>
</html>
