<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infinite Scroll with Search</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .free-text {
      color: red;
    }
    .spinner {
      display: none;
      margin: 20px auto;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="my-4">PDF Files</h1>
  <input type="text" id="searchInput" class="form-control mb-4" placeholder="Search...">
  
  <div id="cardsContainer" class="row"></div>
  <div class="spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
  <p id="noMoreResults" class="text-center"></p>
</div>

<!-- AJAX -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
<!-- Costume CSS -->
<link href="css/flipbook.style.css" rel="stylesheet" type="text/css"/>
<link href="css/font-awesome.css" rel="stylesheet" type="text/css"/>
<link href="css/footer.css" rel="stylesheet" type="text/css"/>
<!-- Bootstrap CSS -->
<link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" rel="stylesheet"/>
<!-- Include JS -->
<script src="js/flipbook.min.js"></script>
<script>
    const itemsPerPage = 12;
    let currentPage = 1;
    let allData = [];
    let filteredData = [];
  
    $(document).ready(function() {
      fetchData();
  
      $('#searchInput').on('input', function() {
        const query = $(this).val().toLowerCase();
        filterData(query);
      });
  
      $(window).scroll(function() {
        if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
          if ((currentPage - 1) * itemsPerPage < filteredData.length) {
            loadMoreData();
          } else {
            $('#noMoreResults').text('NO MORE RESULTS FOUND');
          }
        }
      });
    });
  
    function fetchData() {
      $.getJSON('data.json', function(data) {
        allData = data;
        filteredData = data;
        renderData();
      });
    }
  
    function renderData() {
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = currentPage * itemsPerPage;
      const currentData = filteredData.slice(startIndex, endIndex);
  
      if (currentData.length === 0 && currentPage === 1) {
        $('#cardsContainer').html('<p class="col-12 text-center">NO RESULTS FOUND</p>');
      } else {
        currentData.forEach((item, index) => {
          const pdfId = `read${startIndex + index + 1}`;
          $('#cardsContainer').append(`
            <div class="col-md-4 mb-3">
              <div class="card">
                <div class="card-body">
                  <h3>${item.title}</h3>
                  <p class="description">${item.description}</p>
                  <p>Price: <span class="price"><del>${item.price}</del></span> <span class="free-text">FREE</span></p>
                  <div class="button">
                    <a id="${pdfId}" class="btn btn-primary mt-2 mr-2 text-white">View File <i class="fas fa-book-reader fa-lg"></i></a>
                    <a href="${item.pdfUrl}" class="btn btn-info mt-2 text-white" download>Download File <i class="fas fa-download fa-lg"></i></a>
                  </div>
                </div>
              </div>
            </div>`);
  
          // Initialize flipbook for the current PDF
          $(`#${pdfId}`).flipBook({
            pdfUrl: item.pdfUrl,
            lightBox: true,
            layout: 3,
            currentPage: {
              vAlign: "bottom",
              hAlign: "left"
            },
            btnShare: {
              enabled: false
            },
            btnPrint: {
              enabled: true
            },
            btnDownloadPages: {
              enabled: true
            },
            btnColor: 'rgb(255,120,60)',
            sideBtnColor: 'rgb(255,120,60)',
            sideBtnSize: 60,
            sideBtnBackground: "rgba(0,0,0,.7)",
            sideBtnRadius: 60,
            btnSound: {
              vAlign: "top",
              hAlign: "left"
            },
            btnAutoplay: {
              vAlign: "top",
              hAlign: "left"
            }
          });
        });
        if (currentData.length < itemsPerPage) {
          $('#noMoreResults').text('NO MORE RESULTS FOUND');
        }
      }
    }
  
    function loadMoreData() {
      $('.spinner').show();
      setTimeout(() => {
        currentPage++;
        renderData();
        $('.spinner').hide();
      }, 1000);
    }
  
    function filterData(query) {
      filteredData = allData.filter(item => 
        item.title.toLowerCase().includes(query) || 
        item.description.toLowerCase().includes(query)
      );
      currentPage = 1;
      $('#cardsContainer').empty();
      $('#noMoreResults').text('');
      renderData();
    }
  </script>
  

</body>
</html>
